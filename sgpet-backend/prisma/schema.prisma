// sgpet-backend/prisma/schema.prisma:
generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model Usuario {
  id        Int        @id @default(autoincrement())
  cedula    String?    @unique
  nombres   String
  apellidos String
  email     String     @unique
  password  String
  rol       Rol        @default(ESTUDIANTE)
  activo    Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  prestamos Prestamo[]
}

model Categoria {
  id      Int      @id @default(autoincrement())
  nombre  String   @unique
  equipos Equipo[]
}

model Equipo {
  id          Int          @id @default(autoincrement())
  codigo      String       @unique
  nombre      String
  descripcion String?
  marca       String?
  modelo      String?
  numeroSerie String?      @unique
  estado      EstadoEquipo @default(DISPONIBLE)
  disponible  Boolean      @default(true)
  categoriaId Int
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  categoria   Categoria    @relation(fields: [categoriaId], references: [id])
  prestamos   Prestamo[]

  @@index([categoriaId])
  @@index([estado])
}

model Prestamo {
  id              Int            @id @default(autoincrement())
  estado          EstadoPrestamo @default(PENDIENTE)
  fechaSolicitud  DateTime       @default(now())
  fechaAprobacion DateTime?
  fechaEntrega    DateTime?
  fechaDevolucion DateTime
  observacion     String?
  usuarioId       Int
  equipoId        Int
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  devolucion      Devolucion?
  equipo          Equipo         @relation(fields: [equipoId], references: [id])
  usuario         Usuario        @relation(fields: [usuarioId], references: [id])

  @@index([usuarioId])
  @@index([equipoId])
  @@index([estado])
  @@index([fechaDevolucion])
}

model Devolucion {
  id                     Int              @id @default(autoincrement())
  fecha                  DateTime         @default(now())
  observacion            String?
  estadoEquipoAlDevolver EstadoDevolucion @default(BUENO)
  prestamoId             Int              @unique
  createdAt              DateTime         @default(now())
  prestamo               Prestamo         @relation(fields: [prestamoId], references: [id])
}

/// Esquema de Prisma
enum Rol {
  ADMIN
  DOCENTE
  ESTUDIANTE
}

enum EstadoEquipo {
  DISPONIBLE
  PRESTADO
  MANTENIMIENTO
}

enum EstadoPrestamo {
  PENDIENTE
  APROBADO
  RECHAZADO
  DEVUELTO
  VENCIDO
}

enum EstadoDevolucion {
  BUENO
  CON_DANOS
  NO_FUNCIONAL
}
