/* Esquema de Prisma */
// sgpet-backend/prisma/schema.prisma:
generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

enum Rol {
  ADMIN
  DOCENTE
  ESTUDIANTE
}

enum EstadoEquipo {
  DISPONIBLE
  PRESTADO
  MANTENIMIENTO
}

enum EstadoPrestamo {
  PENDIENTE
  APROBADO
  RECHAZADO
  DEVUELTO
  VENCIDO
}

model Usuario {
  id        Int     @id @default(autoincrement())
  cedula    String? @unique
  nombres   String
  apellidos String
  email     String  @unique
  password  String
  rol       Rol     @default(ESTUDIANTE)
  activo    Boolean @default(true)
  prestamos Prestamo[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Categoria {
  id     Int    @id @default(autoincrement())
  nombre String @unique
  equipos Equipo[]
}

model Equipo {
  id          Int          @id @default(autoincrement())
  codigo      String       @unique
  nombre      String
  descripcion String?
  marca       String?
  modelo      String?
  numeroSerie String?      @unique
  estado      EstadoEquipo @default(DISPONIBLE)
  disponible  Boolean      @default(true)
  categoriaId Int
  categoria   Categoria @relation(fields: [categoriaId], references: [id])
  prestamos Prestamo[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  @@index([categoriaId])
  @@index([estado])
}

model Prestamo {
  id              Int            @id @default(autoincrement())
  estado          EstadoPrestamo @default(PENDIENTE)
  fechaSolicitud  DateTime       @default(now())
  fechaAprobacion DateTime?
  fechaEntrega    DateTime?
  fechaDevolucion DateTime
  observacion     String?
  usuarioId Int
  usuario   Usuario @relation(fields: [usuarioId], references: [id])
  equipoId Int
  equipo   Equipo @relation(fields: [equipoId], references: [id])
  devolucion Devolucion?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([usuarioId])
  @@index([equipoId])
  @@index([estado])
  @@index([fechaDevolucion])
}

model Devolucion {
  id                     Int          @id @default(autoincrement())
  fecha                  DateTime     @default(now())
  observacion            String?
  estadoEquipoAlDevolver EstadoEquipo @default(DISPONIBLE)
  prestamoId Int      @unique
  prestamo   Prestamo @relation(fields: [prestamoId], references: [id])
  createdAt DateTime @default(now())
}
